- description: deploy packages
  executionEnabled: true
  group: deploy
  loglevel: INFO
  name: Copy
  nodefilters:
    dispatch:
      excludePrecedence: true
      keepgoing: false
      rankOrder: ascending
      threadcount: 1
    filter: app.*
  nodesSelectedByDefault: true
  options:
  - description: packages versions
    enforced: true
    name: packages
    required: true
    valuesUrl: http://localhost/anvils/options/packages/${option.release.value}.json
  - description: release tag
    enforced: true
    name: release
    required: true
    valuesUrl: http://localhost/anvils/options/releases/${option.repository.value}.json
  - description: repository name
    enforced: true
    name: repository
    required: true
    valuesUrl: http://localhost/anvils/options/repositories.json
  scheduleEnabled: true
  sequence:
    commands:
    - configuration:
        destinationPath: /var/www/html/anvils/app/
        echo: 'true'
        sourcePath: packages/${option.repository}/${option.release}/${option.packages}
      description: copy packages
      nodeStep: true
      type: copyfile
    - script: |-
        #!/bin/bash

        umask 0000

        echo "Unpacking $RD_OPTION_PACKAGES"
        cd /var/www/html/anvils/app/
        tar xzvf $RD_OPTION_PACKAGES

        echo "Unpacking $RD_OPTION_PACKAGES"
        rm $RD_OPTION_PACKAGES

        echo "Done - see http://192.168.50.2/anvils/app/"
    keepgoing: false
    strategy: node-first
